{% extends "Base/base.html" %}

{% block extra_head %}
<!-- iconos bootstrap y estilos para Select2 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

<style>
     .card {
      border-radius: 1rem; /* borde redondeado */
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05); /* sombra */
      border: 1px solid #dee2e6;
    }
    .section-title {
      font-weight: 600;
      color: #0d6efd; /* fuente de color azul */
    }

    /* Para la pantalla de espera de carga */
    #loading-overlay {
      position: fixed; /* no permite scroll */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%; /* ocupa toda la pantalla */
      background: rgba(255,255,255,0.95); /* fondo prácticamente opaco */
      z-index: 9999; /* por encima de cualquier elemento */
      display: flex;
      justify-content: center;
      align-items: center; /* centrado */
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4"><i class="bi bi-wrench-adjustable-circle"></i> Reinterpretar resultados de antibióticos</h2>

    <form id="filtro-form" method="post">
    {% csrf_token %}

        <div class="card p-4 mb-4">
            <h5 class="section-title mb-3"><i class="bi bi-sliders"></i> Filtros</h5>
            <!-- Campo: Fecha inicio -->
            <div class="mb-3">
                <label class="form-label">{{ form.fecha_inicio.label }}</label>
                {{ form.fecha_inicio }}

                {% if form.fecha_inicio.errors %}
                    <div class="text-danger small">
                        {% for error in form.fecha_inicio.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Campo: Fecha fin -->
            <div class="mb-3">
                <label class="form-label">{{ form.fecha_fin.label }}</label>
                {{ form.fecha_fin }}

                {% if form.fecha_fin.errors %}
                    <div class="text-danger small">
                        {% for error in form.fecha_fin.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Campo: Versión EUCAST -->
            <div class="mb-3">
                <label class="form-label">{{ form.version_eucast.label }}</label>
                {{ form.version_eucast }}

                {% if form.version_eucast.errors %}
                    <div class="text-danger small">
                        {% for error in form.version_eucast.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <!-- Campo: Microorganismo -->
            <div class="mb-3">
                <label class="form-label">{{ form.microorganismo.label }}</label>
                {{ form.microorganismo }}

                {% if form.microorganismo.errors %}
                    <div class="text-danger small">
                        {% for error in form.microorganismo.errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="col-12 text-right">
                <button type="submit" class="btn btn-primary"><i class="bi bi-repeat"></i> Reinterpretar</button>
            </div>
        </div>
</form>
</div>

<!-- Overlay de carga -->
<div id="loading-overlay"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background-color:rgba(255,255,255,0.8); z-index:1050; text-align:center;">
    <div class="d-flex flex-column justify-content-center align-items-center h-100">
        <div class="spinner-border text-primary mb-3" style="width:4rem; height:4rem;" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <h5 class="text-primary">Procesando resultados, por favor espere...</h5>
    </div>
</div>

{% endblock %}

{% block extra_footer %}
<script>
    $(document).ready(function () {
        const $form = $("#filtro-form");
        $form.on('submit', function () {
            $('#loading-overlay').fadeIn(150);
        });
    });
</script>
{% endblock %}
